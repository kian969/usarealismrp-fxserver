import{r,a as s,j as a,F as v}from"./jsx-runtime-f40812bf.js";import{b as A,f as L,u as x,L as t,k as F,n as b,aI as w,_ as D,c as I,h as O}from"./Phone-bbdfbfe1.js";import{r as T,f as P}from"./number-28525126.js";import{N as B}from"./Numpad-c596be12.js";function H(){const h=A(I.Settings),c=A(O),[l,p]=r.useState({balance:0,transactions:[],bills:[]}),[m,d]=r.useState(!1),[g,M]=r.useState(""),[i,S]=r.useState(0),[C,E]=r.useState(!1),[n,o]=r.useState(""),[N,u]=r.useState(null);r.useEffect(()=>{L("Wallet",{action:"getData"}).then(e=>{e&&p(e)})},[]),r.useEffect(()=>{o(""),S(0)},[m]),x("wallet:addTransaction",e=>{h.airplaneMode||p({...l,balance:l.balance+e.amount,transactions:[e,...l.transactions].slice(0,5)})}),r.useEffect(()=>{i===0?n.length>3?E(!0):E(!1):i===1&&(n.length>0&&W(parseFloat(n))&&parseFloat(n)<=(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER)?E(!0):E(!1))},[n]);const W=e=>l.balance>=e,k=e=>{if(e=="backspace")return o(f=>f.length>0?f.slice(0,-1):"0");o(f=>f+e)};return r.useEffect(()=>{if(i!==1||n.length>=9)return;const e=document.getElementById("number");e.style.width=`${n.length}ch`,N&&u(null)},[n]),r.useEffect(()=>{u(null)},[i]),s("div",{className:"wallet-app-container",children:[m&&s("div",{className:"send-container",children:[s("div",{className:"send-header",children:[a("div",{onClick:()=>d(!1),children:t("CANCEL")}),i===2?a("div",{onClick:()=>d(!1),children:t("APPS.WALLET.DONE")}):a("div",{className:!C&&"disabled",onClick:()=>{if(C){if(i==0)L("Wallet",{action:"doesNumberExist",number:n}).then(e=>{e?(M(n),S(1),o("")):u(t("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))});else if(i==1){if(!W(parseFloat(n)))return u(t("APPS.WALLET.NOT_ENOUGH_MONEY"));if(parseFloat(n)>(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return u("Max transfer amount reached");if(h.airplaneMode)return;L("Wallet",{action:"sendPayment",number:g,amount:Math.floor(parseFloat(n))}).then(e=>{e!=null&&e.success?S(2):u(t("APPS.WALLET.NOT_ENOUGH_MONEY"))})}}},children:t("APPS.WALLET.NEXT")})]}),s("div",{className:"send-wrapper",children:[i===0&&s(v,{children:[a("div",{className:"user",children:a(F,{className:"number_input",type:"number",onChange:e=>o(e.target.value.replace(/[^0-9]/g,"")),value:n,placeholder:b("1234567890")})}),a("div",{className:"description",children:t("APPS.WALLET.NO_REFUNDS")}),N&&a("div",{className:"error",children:N})]}),i===1&&s(v,{children:[s("div",{className:"amount",children:[a("div",{className:"symbol",children:c.CurrencyFormat.replace("%s","")}),a(F,{type:"number",id:"number",value:n,onChange:e=>o(e.target.value.replace(/[^0-9]/g,""))})]}),s("div",{className:"description",children:[t("APPS.WALLET.NEW_BALANCE"),": ",c.CurrencyFormat.replace("%s",""),T(l.balance-parseFloat(n),2)]}),N&&a("div",{className:"error",children:N})]}),i===2&&s("div",{className:"success",children:[a(w,{}),a("div",{className:"title",children:t("APPS.WALLET.DONE")}),a("div",{className:"subtitle",children:t("APPS.WALLET.DONE_SUBTITLE").format({amount:c.CurrencyFormat.replace("%s",n),number:b(g)})})]})]}),i!==2&&a("div",{className:"numpad-wrapper",children:a(B,{cb:e=>k(e)})})]}),s("div",{className:"overview",children:[a("div",{className:"header-title",children:t("APPS.WALLET.TITLE")}),s("div",{className:"wrapper",children:[a("div",{className:"card"}),a("section",{children:s("div",{className:"item space",children:[s("div",{className:"balance",children:[a("div",{className:"title",children:t("APPS.WALLET.BALANCE")}),a(R,{amount:l.balance})]}),a("div",{className:"button",onClick:()=>d(!0),children:t("APPS.WALLET.SEND")})]})}),l.transactions&&l.transactions.length>0&&s(v,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:t("APPS.WALLET.LATEST_TRANSACTIONS")})}),a("section",{children:l.transactions.map((e,f)=>{let _=e.amount>0,y=e.company.match(/\d{10}/);return s("div",{className:"item multi",children:[e.logo?a("img",{src:e.logo}):!y&&a("div",{className:"image",children:e.company[0]}),s("div",{className:"info",children:[s("div",{className:"transaction-header",children:[a("div",{className:"title",children:y?b(e.company):e.company}),a("div",{className:"right",children:s("div",{className:`amount ${_?"green":"red"}`,children:[!_&&"-",c.CurrencyFormat.replace("%s",P(Math.abs(e.amount)))]})})]}),a("div",{className:"date",children:D(e.timestamp)})]})]})})})]}),l.bills&&l.bills.length>0&&s(v,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:t("APPS.WALLET.LATEST_BILLS")})}),a("section",{})]})]})]})]})}const R=({amount:h})=>{const c=A(O),[l,p]=r.useState(!0),m=A(I.Settings);let d;return l&&(m!=null&&m.streamerMode)?d=P(parseInt("âŽ".repeat(T(h,2).toString().length))):d=P(T(h,2)),a("div",{className:"value",onClick:()=>p(!l),children:c.CurrencyFormat.replace("%s",d)})};export{H as default};
